<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Stendhal: Introduction</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../StendhalIcon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Stendhal
   &#160;<span id="projectnumber">1.38.5</span>
   </div>
   <div id="projectbrief">A fun, friendly, &amp; free multiplayer online adventure game.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d5/d57/scripting.html">Scripting</a></li><li class="navelem"><a class="el" href="../../d9/deb/lua.html">Lua</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md3">Lua Basics</a><ul><li class="level2"><a href="#autotoc_md4">Comments</a></li>
<li class="level2"><a href="#autotoc_md5">Variables</a></li>
<li class="level2"><a href="#autotoc_md6">Data Types</a><ul><li class="level3"><a href="#autotoc_md7">Strings</a><ul><li class="level4"><a href="#autotoc_md8">String Concatenation</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md9">Tables</a><ul><li class="level4"><a href="#autotoc_md10">Creating Tables</a></li>
<li class="level4"><a href="#autotoc_md11">Accessing Table Values</a></li>
<li class="level4"><a href="#autotoc_md12">Iterating Tables</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md13">Functions</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md14">Comparison Operators</a><ul><li class="level3"><a href="#autotoc_md15">Logical Operators</a></li>
<li class="level3"><a href="#autotoc_md16">Relational Operators</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md17">Stendhal Application</a><ul><li class="level2"><a href="#autotoc_md18">Zones</a><ul><li class="level3"><a href="#autotoc_md19">Setting Zone</a></li>
<li class="level3"><a href="#autotoc_md20">Create New Zone</a></li>
<li class="level3"><a href="#autotoc_md21">Add Zone Music</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md22">Adding Entities</a><ul><li class="level3"><a href="#autotoc_md23">Signs</a></li>
<li class="level3"><a href="#autotoc_md24">NPCs</a><ul><li class="level4"><a href="#autotoc_md25">Adding Transitions</a></li>
<li class="level4"><a href="#autotoc_md26">Adding Merchant Behavior</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md27">System Properties</a></li>
<li class="level2"><a href="#autotoc_md28">Misc</a><ul><li class="level3"><a href="#autotoc_md29">Typecasting</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><span style="color: red; font-style: italic;">this page is a work-in progress</span></p>
<p>Stendhal supports <a href="https://www.lua.org/">Lua scripting</a> via the <a href="https://sourceforge.net/projects/luaj/">LuaJ library</a>.</p>
<p>Lua scripts end in the <code>.lua</code> extension &amp; are stored in the <code>data/script</code> directory.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Lua Basics</h1>
<p>For more detailed information, see the <a href="https://www.lua.org/docs.html">Lua reference manual</a>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Comments</h2>
<p>Lua uses double dashes (<code>--</code>) for single line comments &amp; double dashes followed by double square brackets (<code>[[</code>) &amp; closed with double square brackets (<code>]]</code>) for multi-line comments:</p>
<div class="fragment"><div class="line">-- a single line comment</div>
<div class="line"> </div>
<div class="line">--[[</div>
<div class="line">a multi-line comment</div>
<div class="line">]]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Variables</h2>
<p>By default, Lua variables are set in <a href="https://en.wikipedia.org/wiki/Global_variable"><b>global</b> scope</a> (meaning it is exposed to the entire Lua engine). To create a variable in <a href="https://en.wikipedia.org/wiki/Local_variable"><b>local</b> scope</a>, the <code>local</code> keyword must be used:</p>
<div class="fragment"><div class="line">-- a global variable</div>
<div class="line">var1 = &quot;Hello world!&quot;</div>
<div class="line"> </div>
<div class="line">-- a local variable</div>
<div class="line">local var2 = &quot;Hello world!&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Data Types</h2>
<p>Some common data types in Lua are <em>string</em>, <em>integer</em>, <em>boolean</em>, &amp; <em>table</em>. Type names do not need to be declared when setting variables.</p>
<p>Examples: </p><div class="fragment"><div class="line">-- string variable</div>
<div class="line">local var1 = &quot;Hello world!&quot;</div>
<div class="line"> </div>
<div class="line">-- integer variable</div>
<div class="line">local var2 = 11</div>
<div class="line"> </div>
<div class="line">-- boolean variable</div>
<div class="line">local var3 = true</div>
<div class="line"> </div>
<div class="line">-- table variable</div>
<div class="line">local var4 = {}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Strings</h3>
<h4><a class="anchor" id="autotoc_md8"></a>
String Concatenation</h4>
<p>String concatenation is simple, much like Java uses a plus operator (<code>+</code>) to join strings, Lua uses two periods (<code>..</code>).</p>
<p>Example: </p><div class="fragment"><div class="line">-- create a string variable</div>
<div class="line">local var = &quot;Hello&quot;</div>
<div class="line"> </div>
<div class="line">-- append another string</div>
<div class="line">var = var .. &quot; world!&quot;</div>
<div class="line"> </div>
<div class="line">print(var) -- prints &quot;Hello world!&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Tables</h3>
<p>A Lua table is a data type similar to a Java list or map. Tables can be indexed or use key=value pairs.</p>
<p>(<span style="color:red; font-style:italic;">IMPORTANT NOTE: Lua table indexes begin at 1, not 0</span>)</p>
<h4><a class="anchor" id="autotoc_md10"></a>
Creating Tables</h4>
<p>An empty table is initialized with a pair of curly braces (<code>{}</code>): </p><div class="fragment"><div class="line">local mytable = {}</div>
</div><!-- fragment --><p>You can add values to indexed tables at initialization or with the <code>table.insert</code> method: </p><div class="fragment"><div class="line">-- create a table with values</div>
<div class="line">local mytable = {&quot;foo&quot;}</div>
<div class="line"> </div>
<div class="line">-- add value</div>
<div class="line">table.insert(mytable, &quot;bar&quot;)</div>
</div><!-- fragment --><p>To create a key=value table, any of the following methods can be used to add values: </p><div class="fragment"><div class="line">-- all of these do the same thing, that is, assigning &quot;bar&quot; to mytable.foo</div>
<div class="line">local mytable {</div>
<div class="line">    foo = &quot;bar&quot;,</div>
<div class="line">    [&quot;foo&quot;] = &quot;bar&quot;,</div>
<div class="line">}</div>
<div class="line">mytable.foo = &quot;bar&quot;</div>
<div class="line">mytable[&quot;foo&quot;] = &quot;bar&quot;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md11"></a>
Accessing Table Values</h4>
<p>Square brackets (<code>[]</code>) enclosing an index number are used to access values in indexed tables (<em>remember that Lua table indexes start at "1" not "0"</em>): </p><div class="fragment"><div class="line">local mytable = {&quot;foo&quot;, &quot;bar&quot;}</div>
<div class="line"> </div>
<div class="line">print(mytable[1]) -- prints &quot;foo&quot;</div>
<div class="line">print(mytable[2]) -- prints &quot;bar&quot;</div>
</div><!-- fragment --><p>In a key=value table, values can be accessed by either enclosing the key string in square brackets or concatenating the key member using a <code>.</code>: </p><div class="fragment"><div class="line">local mytable = {foo=&quot;bar&quot;}</div>
<div class="line"> </div>
<div class="line">-- using square brackets</div>
<div class="line">print(mytable[&quot;foo&quot;]) -- prints &quot;bar&quot;</div>
<div class="line"> </div>
<div class="line">-- using concatenated member</div>
<div class="line">print(mytable.foo) -- prints &quot;bar&quot;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md12"></a>
Iterating Tables</h4>
<p>Tables can be iterated in a <code>for</code> loop using the <code>pairs</code> or <code>ipairs</code> iterators. Loops are terminated with the <code>end</code> keyword: </p><div class="fragment"><div class="line">local mytable = {&quot;foo&quot;, &quot;bar&quot;}</div>
<div class="line"> </div>
<div class="line">print(&quot;indexes:&quot;)</div>
<div class="line">for idx in pairs(mytable) do</div>
<div class="line">    print(idx)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">print(&quot;\nvalues:&quot;)</div>
<div class="line">for idx, value in pairs(mytable) do</div>
<div class="line">    print(value)</div>
<div class="line">end</div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">indexes:</div>
<div class="line">1</div>
<div class="line">2</div>
<div class="line"> </div>
<div class="line">values:</div>
<div class="line">foo</div>
<div class="line">bar</div>
</div><!-- fragment --><p>Using a key=value table: </p><div class="fragment"><div class="line">local mytable = {</div>
<div class="line">    [&quot;foo&quot;] = &quot;hello&quot;,</div>
<div class="line">    [&quot;bar&quot;] = &quot; world!&quot;,</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">print(&quot;keys:&quot;)</div>
<div class="line">for key in pairs(mytable) do</div>
<div class="line">    print(key)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">print(&quot;\nvalues:&quot;)</div>
<div class="line">for key, value in pairs(mytable) do</div>
<div class="line">    print(value)</div>
<div class="line">end</div>
</div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">keys:</div>
<div class="line">foo</div>
<div class="line">bar</div>
<div class="line"> </div>
<div class="line">values:</div>
<div class="line">hello</div>
<div class="line"> world!</div>
</div><!-- fragment --><p>See also: <a href="http://lua-users.org/wiki/TablesTutorial">Lua Tables Tutorial</a></p>
<h3><a class="anchor" id="autotoc_md13"></a>
Functions</h3>
<p>Like normal variables, functions can be declared as <b>global</b> or <b>local</b> &amp; must be terminated with the <code>end</code> keyword.</p>
<p>There are two ways to define functions with the <code>function</code> keyword: </p><div class="fragment"><div class="line">local function myFunction()</div>
<div class="line">    print(&quot;Hello world!&quot;)</div>
<div class="line">end</div>
</div><!-- fragment --><p>or </p><div class="fragment"><div class="line">local myFunction = function()</div>
<div class="line">    print(&quot;Hello world!&quot;)</div>
<div class="line">end</div>
</div><!-- fragment --><p>Functions can also be members of a table: </p><div class="fragment"><div class="line">local myTable = {}</div>
<div class="line">function myTable.myFunction()</div>
<div class="line">    print(&quot;Hello world!&quot;)</div>
<div class="line">end</div>
</div><!-- fragment --><p>or </p><div class="fragment"><div class="line">local myTable = {}</div>
<div class="line">myTable.myFunction = function()</div>
<div class="line">    print(&quot;Hello world!&quot;)</div>
<div class="line">end</div>
</div><!-- fragment --><p>or </p><div class="fragment"><div class="line">local myTable = {</div>
<div class="line">    myFunction = function()</div>
<div class="line">        print(&quot;Hello world!&quot;)</div>
<div class="line">    end,</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">-- execute with</div>
<div class="line">myTable.myFunction()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
Comparison Operators</h2>
<h3><a class="anchor" id="autotoc_md15"></a>
Logical Operators</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operator </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Java Equivalent  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">and </td><td class="markdownTableBodyNone">logical <em>and</em> </td><td class="markdownTableBodyNone">&amp;&amp;  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">or </td><td class="markdownTableBodyNone">logical <em>or</em> </td><td class="markdownTableBodyNone">||  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">not </td><td class="markdownTableBodyNone">logical <em>inverse</em> </td><td class="markdownTableBodyNone">!  </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md16"></a>
Relational Operators</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operator </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Java Equivalent  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt; </td><td class="markdownTableBodyNone">less than </td><td class="markdownTableBodyNone">&lt;  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&gt; </td><td class="markdownTableBodyNone">greater than </td><td class="markdownTableBodyNone">&gt;  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;= </td><td class="markdownTableBodyNone">less than or equal to </td><td class="markdownTableBodyNone">&lt;=  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&gt;= </td><td class="markdownTableBodyNone">greater than or equal to </td><td class="markdownTableBodyNone">&gt;=  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">== </td><td class="markdownTableBodyNone">equal to </td><td class="markdownTableBodyNone">==  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">~= </td><td class="markdownTableBodyNone">not equal to </td><td class="markdownTableBodyNone">!=  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md17"></a>
Stendhal Application</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Zones</h2>
<h3><a class="anchor" id="autotoc_md19"></a>
Setting Zone</h3>
<p>To set the zone to work with, use the <code>game</code> object:</p>
<div class="fragment"><div class="line">game:setZone(&quot;0_semos_city&quot;)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md20"></a>
Create New Zone</h3>
<p>It is recommended to create new zones in the XML configurations in <a href="https://github.com/arianne/stendhal/blob/master/data/conf/zones">data/conf/zones</a>.</p>
<p>Currently creating new zones via Lua is not supported.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Add Zone Music</h3>
<p>Music can be added to zones with the <code>game:setMusic</code> function. It supports the following arguments:</p><ul>
<li><span style="color:darkgreen; font-style:italic;">filename:</span> Basename of the OGG audio file to use stored in <a href="https://github.com/arianne/stendhal/blob/master/data/music">data/music</a>.</li>
<li><span style="color:darkgreen; font-style:italic;">args:</span> A table of key=value integers.</li>
<li>Valid keys:<ul>
<li><span style="color:darkblue; font-style:italic;">volume:</span> Volume level (default: 100).</li>
<li><span style="color:darkblue; font-style:italic;">x:</span> The horizontal point for the source of the music (default: 1).</li>
<li><span style="color:darkblue; font-style:italic;">y:</span> The vertical point for the source of the music (default: 1).</li>
<li><span style="color:darkblue; font-style:italic;">radius:</span> The radial range at which the music can be heard (default: 10000).</li>
</ul>
</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line">if game:setZone(&quot;0_semos_plains_n&quot;) then</div>
<div class="line">    game:setMusic(&quot;pleasant_creek_loop&quot;, {volume=85, radius=100})</div>
<div class="line">end</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Adding Entities</h2>
<h3><a class="anchor" id="autotoc_md23"></a>
Signs</h3>
<p>Signs can be created with <code>entities:createSign</code> and <code>entities:createShopSign</code>:</p>
<div class="fragment"><div class="line">local zone = &quot;0_semos_city&quot;</div>
<div class="line">if game:setZone(zone) then</div>
<div class="line">    -- create the sign instance</div>
<div class="line">    local sign = entities:createSign()</div>
<div class="line">    sign:setEntityClass(&quot;signpost&quot;)</div>
<div class="line">    sign:setPosition(12, 55)</div>
<div class="line">    sign:setText(&quot;Meet Lua!&quot;)</div>
<div class="line"> </div>
<div class="line">    -- Add it to the world</div>
<div class="line">    game:add(sign)</div>
<div class="line">else</div>
<div class="line">    logger:error(&quot;Could not set zone: &quot; .. zone)</div>
<div class="line">end</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md24"></a>
NPCs</h3>
<p>Use the <code>entities:createSpeakerNPC</code> method to create an interactive NPC:</p>
<div class="fragment"><div class="line">local zone = &quot;0_semos_city&quot;</div>
<div class="line">if game:setZone(zone) then</div>
<div class="line">    -- Use helper object to create a new NPC</div>
<div class="line">    local npc = entities:createSpeakerNPC(&quot;Lua&quot;)</div>
<div class="line">    npc:setEntityClass(&quot;littlegirlnpc&quot;)</div>
<div class="line">    npc:setPosition(10, 55)</div>
<div class="line">    npc:setBaseSpeed(0.1)</div>
<div class="line">    npc:setCollisionAction(CollisionAction.STOP)</div>
<div class="line"> </div>
<div class="line">    local nodes = {</div>
<div class="line">        {10, 55},</div>
<div class="line">        {11, 55},</div>
<div class="line">        {11, 56},</div>
<div class="line">        {10, 56},</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    npc:setPath(nodes)</div>
<div class="line"> </div>
<div class="line">    -- Dialogue</div>
<div class="line">    npc:addJob(&quot;Actually, I am jobless.&quot;)</div>
<div class="line">    npc:addGoodbye();</div>
<div class="line"> </div>
<div class="line">    -- Add to the world</div>
<div class="line">    game:add(npc)</div>
<div class="line">else</div>
<div class="line">    logger:error(&quot;Could not set zone: &quot; .. zone)</div>
<div class="line">end</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md25"></a>
Adding Transitions</h4>
<p>A simple example of adding a chat transition can be done without any special functionality: </p><div class="fragment"><div class="line">local frank = entities:createSpeakerNPC(&quot;Frank&quot;)</div>
<div class="line">frank:add(ConversationStates.IDLE,</div>
<div class="line">    ConversationPhrases.GREETING_MESSAGES,</div>
<div class="line">    nil,</div>
<div class="line">    ConversationStates.ATTENDING,</div>
<div class="line">    &quot;Hello.&quot;,</div>
<div class="line">    nil)</div>
</div><!-- fragment --><p>This simply adds a response to saying "hello" &amp; sets the NPC to attend to the player (equivalent of <code>frank:addGreeting("Hello")</code>).</p>
<p>For more complicated behavior, we need to use some helper methods. If we want to check a condition we use the <code>conditions:create</code> method. The first parameter is the string name of the ChatCondition we want to instantiate. The second parameter is a table that contains the values that should be passed to the ChatCondition constructor.</p>
<p>Example: </p><div class="fragment"><div class="line">frank:add(ConversationStates.IDLE,</div>
<div class="line">    ConversationPhrases.GREETING_MESSAGES,</div>
<div class="line">    conditions:create(&quot;PlayerHasItemWithHimCondition&quot;, {&quot;money&quot;}),</div>
<div class="line">    ConversationStates.ATTENDING,</div>
<div class="line">    &quot;Hello.&quot;,</div>
<div class="line">    nil)</div>
</div><!-- fragment --><p>In this scenario, the NPC will only respond if the player is carrying <a href="https://stendhalgame.org/item/money/money.html">money</a>.</p>
<p>A NotCondition instance can be created with the <code>actions:notCondition</code> method:</p>
<p>Example usage: </p><div class="fragment"><div class="line">local condition = conditions.notCondition(conditions:create(&quot;PlayerHasItemWithHimCondition&quot;, {&quot;money&quot;})</div>
</div><!-- fragment --><p>To add a ChatAction, we use the <code>actions:create</code> method. Its usage is identical to <code>conditions:create</code>.</p>
<p>Example: </p><div class="fragment"><div class="line">frank:add(ConversationStates.IDLE,</div>
<div class="line">    ConversationPhrases.GREETING_MESSAGES,</div>
<div class="line">    conditions:create(&quot;PlayerHasItemWithHimCondition&quot;, {&quot;money&quot;}),</div>
<div class="line">    ConversationStates.ATTENDING,</div>
<div class="line">    &quot;Hello.&quot;,</div>
<div class="line">    actions:create(&quot;NPCEmoteAction&quot;, {&quot;looks greedily at your pouch of money.&quot;, false}))</div>
</div><!-- fragment --><p>Lua tables can be used to add multiple conditions or actions: </p><div class="fragment"><div class="line">frank:add(ConversationStates.IDLE,</div>
<div class="line">    ConversationPhrases.GREETING_MESSAGES,</div>
<div class="line">    {</div>
<div class="line">        conditions:create(&quot;PlayerHasItemWithHimCondition&quot;, {&quot;money&quot;}),</div>
<div class="line">        conditions:notCondition(conditions:create(&quot;NakedCondition&quot;)),</div>
<div class="line">    },</div>
<div class="line">    ConversationStates.ATTENDING,</div>
<div class="line">    nil,</div>
<div class="line">    {</div>
<div class="line">        actions:create(&quot;SayTextAction&quot;, {&quot;Hello.&quot;}),</div>
<div class="line">        actions:create(&quot;NPCEmoteAction&quot;, {&quot;looks greedily at your pouch of money.&quot;, false}),</div>
<div class="line">    })</div>
</div><!-- fragment --><p>In this scenario, the NPC will respond if the player has money &amp; is not naked.</p>
<p>Nested tables are supported as well: </p><div class="fragment"><div class="line">local conditions = {</div>
<div class="line">    conditions:create(&quot;PlayerHasItemWithHimCondition&quot;, {&quot;money&quot;}),</div>
<div class="line">    {</div>
<div class="line">        conditions:notCondition(conditions:create(&quot;NakedCondition&quot;)),</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">frank:add(ConversationStates.IDLE,</div>
<div class="line">    ConversationPhrases.GREETING_MESSAGES,</div>
<div class="line">    conditions,</div>
<div class="line">    ConversationStates.ATTENDING,</div>
<div class="line">    nil,</div>
<div class="line">    {</div>
<div class="line">        actions:create(&quot;SayTextAction&quot;, {&quot;Hello.&quot;}),</div>
<div class="line">        actions:create(&quot;NPCEmoteAction&quot;, {&quot;looks greedily at your pouch of money.&quot;, false}),</div>
<div class="line">    })</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md26"></a>
Adding Merchant Behavior</h4>
<p>The <code>merchants</code> object is used for adding merchant behavior (buying/selling) to an NPC.</p>
<p>Example of adding seller behavior to an NPC: </p><div class="fragment"><div class="line">if game:setZone(&quot;0_semos_city&quot;) then</div>
<div class="line">    local frank = entities.createSpeakerNPC(&quot;Frank&quot;)</div>
<div class="line">    merchants:addSeller(frank, merchants.shops:get(&quot;shopname&quot;), true)</div>
<div class="line"> </div>
<div class="line">    game:add(frank)</div>
<div class="line">end</div>
</div><!-- fragment --><p>To create a custom shop list, you can use a Lua table (there are multiple ways to add elements to a Lua table):</p>
<p>Method 1: </p><div class="fragment"><div class="line">local priceList = {</div>
<div class="line">    meat = 50,</div>
<div class="line">    [&quot;ham&quot;] = 70,</div>
<div class="line">}</div>
</div><!-- fragment --><p>Method 2: </p><div class="fragment"><div class="line">local priceList = {}</div>
<div class="line">priceList.meat = 50</div>
<div class="line">priceList[&quot;ham&quot;] = 70</div>
</div><!-- fragment --><p>The helper methods have special handling for underscore characters as well (the following are all the same): </p><div class="fragment"><div class="line">local priceList = {</div>
<div class="line">    smoked_ham = 100,</div>
<div class="line">    [&quot;smoked ham&quot;] = 100,</div>
<div class="line">}</div>
<div class="line">priceList.smoked_ham = 100</div>
<div class="line">priceList[&quot;smoked ham&quot;] = 100</div>
</div><!-- fragment --><p>Then add the seller behavior using the custom list: </p><div class="fragment"><div class="line">merchants:addSeller(frank, priceList, true)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
System Properties</h2>
<p>Java's system properties are exposed to Lua with the <code>properties</code> object.</p>
<p>Examples: </p><div class="fragment"><div class="line">-- property state</div>
<div class="line">if properties:enabled(&quot;stendhal.testserver&quot;) then</div>
<div class="line">    print(&quot;Test server enabled&quot;)</div>
<div class="line">    if properties:equals(&quot;stendhal.testserver&quot;, &quot;junk&quot;) then</div>
<div class="line">        print(&quot;Junk enabled&quot;)</div>
<div class="line">    else</div>
<div class="line">        print(&quot;Junk disabled&quot;)</div>
<div class="line">    end</div>
<div class="line">else</div>
<div class="line">    print(&quot;Test server disabled&quot;)</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">-- property value</div>
<div class="line">local prop = properties:getValue(&quot;stendhal.testserver&quot;)</div>
<div class="line">if prop ~= nil then</div>
<div class="line">    print(&quot;Test server enabled&quot;)</div>
<div class="line">    if prop == &quot;junk&quot; then</div>
<div class="line">        print(&quot;Junk enabled&quot;)</div>
<div class="line">    else</div>
<div class="line">        print(&quot;Junk disabled&quot;)</div>
<div class="line">    end</div>
<div class="line">else</div>
<div class="line">    print(&quot;Test server disabled&quot;)</div>
<div class="line">end</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
Misc</h2>
<h3><a class="anchor" id="autotoc_md29"></a>
Typecasting</h3>
<p>Lua does not support typecasting (as far as I know), but if the class you want to cast to has a copy constructor, achieving the same functionality is quite simple.</p>
<div class="fragment"><div class="line">-- &quot;entities:getItem&quot; returns an instance of Item</div>
<div class="line">local bestiary = entities:getItem(&quot;bestiary&quot;)</div>
<div class="line"> </div>
<div class="line">-- in order to use the bestiary&#39;s &quot;setOwner&quot; method, we must convert it to an &quot;OwnedItem&quot; instance by calling its copy constructor</div>
<div class="line">bestiary = luajava.newInstance(&quot;games.stendhal.server.entity.item.OwnedItem&quot;, bestiary)</div>
<div class="line">bestiary:setOwner(&quot;Ted&quot;)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
